/*
 * jQuery Pines Notify (pnotify) Plugin 1.0
 *
 * Copyright (c) 2009 Hunter Perrin
 *
 * Licensed (along with all of Pines) under the GNU Affero GPL:
 *	  http://www.gnu.org/licenses/agpl.html
 */
(function(c){var l,m,n,k,i,o;c.extend({pnotify_remove_all:function(){var g=i.data("pnotify");g&&g.length&&c.each(g,function(){this.pnotify_remove&&this.pnotify_remove()})},pnotify_position_all:function(){k&&clearTimeout(k);k=null;var g=l,j=m,a=0,b=i.data("pnotify");b&&b.length&&c.each(b,function(){if(this.css("display")!="none"){var f,h,d={};f=this.offset().top-o.scrollTop();if(typeof l=="undefined")g=l=f;if(typeof window.innerHeight!="undefined"){h=parseInt(this.css("right"));if(isNaN(h))h=18;if(typeof m==
"undefined")j=m=h;if(g+this.height()>window.innerHeight){g=l;j+=a+10;a=0}if(j<h)d.right=j+"px";else this.css("right",j+"px");if(this.outerWidth(true)>a)a=this.width()}if(g)if(f>g||d.right)d.top=g+"px";else this.css("top",g+"px");if(d.top||d.right)this.animate(d,{duration:500,queue:false});g+=this.height()+10}})},pnotify:function(g){i||(i=c("body"));o||(o=c(window));var j,a;if(typeof g=="string"){a=c.extend({},c.pnotify.defaults);a.pnotify_text=g}else a=c.extend({},c.pnotify.defaults,g);if(a.pnotify_before_init)if(a.pnotify_before_init(a)===
false)return null;var b=c("<div />",{"class":"ui-widget ui-helper-clearfix ui-pnotify "+a.pnotify_addclass,css:{display:"none"},mouseenter:function(){if(j=="out"){b.stop(true);b.css("height","auto").animate({width:a.pnotify_width,opacity:a.pnotify_opacity},"fast")}a.pnotify_hide&&b.pnotify_cancel_remove();a.pnotify_closer&&b.closer.show()},mouseleave:function(){a.pnotify_hide&&b.pnotify_queue_remove();b.closer.hide();c.pnotify_position_all()}});b.opts=a;b.container=c("<div />",{"class":"ui-corner-all ui-pnotify-container "+
(a.pnotify_type=="error"?"ui-state-error":"ui-state-highlight")}).appendTo(b);b.pnotify_version="1.0.0";b.pnotify=function(d){var e=a;if(typeof d=="string")a.pnotify_text=d;else a=c.extend({},a,d);b.opts=a;if(a.pnotify_addclass===false)b.removeClass(e.pnotify_addclass);else a.pnotify_addclass!==e.pnotify_addclass&&b.removeClass(e.pnotify_addclass).addClass(a.pnotify_addclass);if(a.pnotify_title===false)b.title_container.hide("fast");else a.pnotify_title!==e.pnotify_title&&b.title_container.html(a.pnotify_title).show("fast");
if(a.pnotify_text===false)b.text_container.hide("fast");else if(a.pnotify_text!==e.pnotify_text){if(a.pnotify_insert_brs)a.pnotify_text=a.pnotify_text.replace("\n","<br />");b.text_container.html(a.pnotify_text).show("fast")}b.pnotify_history=a.pnotify_history;a.pnotify_type!=e.pnotify_type&&b.container.toggleClass("ui-state-error ui-state-highlight");if(a.pnotify_notice_icon!=e.pnotify_notice_icon&&a.pnotify_type=="notice"||a.pnotify_error_icon!=e.pnotify_error_icon&&a.pnotify_type=="error"||a.pnotify_type!=
e.pnotify_type){b.container.find("div.ui-pnotify-icon").remove();if(a.pnotify_error_icon&&a.pnotify_type=="error"||a.pnotify_notice_icon)c("<div />",{"class":"ui-pnotify-icon"}).append(c("<span />",{"class":a.pnotify_type=="error"?a.pnotify_error_icon:a.pnotify_notice_icon})).prependTo(b.container)}a.pnotify_width!==e.pnotify_width&&b.animate({width:a.pnotify_width});a.pnotify_min_height!==e.pnotify_min_height&&b.container.animate({minHeight:a.pnotify_min_height});a.pnotify_opacity!==e.pnotify_opacity&&
b.fadeTo(a.pnotify_animate_speed,a.pnotify_opacity);if(a.pnotify_hide)e.pnotify_hide||b.pnotify_queue_remove();else b.pnotify_cancel_remove();b.pnotify_queue_position();return b};b.pnotify_queue_position=function(){k&&clearTimeout(k);k=setTimeout(c.pnotify_position_all,10)};b.pnotify_display=function(){b.parent().length||b.appendTo(i);if(a.pnotify_before_open)if(a.pnotify_before_open(b)===false)return;b.pnotify_queue_position();if(a.pnotify_animation=="fade"||a.pnotify_animation.effect_in=="fade")b.show().fadeTo(0,
0).hide();else a.pnotify_opacity!=1&&b.show().fadeTo(0,a.pnotify_opacity).hide();b.animate_in(function(){a.pnotify_after_open&&a.pnotify_after_open(b);b.pnotify_queue_position();a.pnotify_hide&&b.pnotify_queue_remove()})};b.pnotify_remove=function(){if(b.timer){window.clearTimeout(b.timer);b.timer=null}if(a.pnotify_before_close)if(a.pnotify_before_close(b)===false)return;b.animate_out(function(){if(a.pnotify_after_close)if(a.pnotify_after_close(b)===false)return;b.pnotify_queue_position();a.pnotify_remove&&
b.detach()})};b.animate_in=function(d){j="in";var e;e=typeof a.pnotify_animation.effect_in!="undefined"?a.pnotify_animation.effect_in:a.pnotify_animation;if(e=="none"){b.show();d()}else if(e=="show")b.show(a.pnotify_animate_speed,d);else if(e=="fade")b.show().fadeTo(a.pnotify_animate_speed,a.pnotify_opacity,d);else if(e=="slide")b.slideDown(a.pnotify_animate_speed,d);else if(typeof e=="function")e("in",d,b);else b.effect&&b.effect(e,{},a.pnotify_animate_speed,d)};b.animate_out=function(d){j="out";
var e;e=typeof a.pnotify_animation.effect_out!="undefined"?a.pnotify_animation.effect_out:a.pnotify_animation;if(e=="none"){b.hide();d()}else if(e=="show")b.hide(a.pnotify_animate_speed,d);else if(e=="fade")b.fadeOut(a.pnotify_animate_speed,d);else if(e=="slide")b.slideUp(a.pnotify_animate_speed,d);else if(typeof e=="function")e("out",d,b);else b.effect&&b.effect(e,{},a.pnotify_animate_speed,d)};b.pnotify_cancel_remove=function(){b.timer&&window.clearTimeout(b.timer)};b.pnotify_queue_remove=function(){b.pnotify_cancel_remove();
b.timer=window.setTimeout(function(){b.pnotify_remove()},isNaN(a.pnotify_delay)?0:a.pnotify_delay)};b.closer=c("<div />",{"class":"ui-pnotify-closer",css:{cursor:"pointer",display:"none"},click:function(){b.pnotify_remove();b.closer.hide()}}).append(c("<span />",{"class":"ui-icon ui-icon-circle-close"})).appendTo(b.container);if(a.pnotify_error_icon&&a.pnotify_type=="error"||a.pnotify_notice_icon)c("<div />",{"class":"ui-pnotify-icon"}).append(c("<span />",{"class":a.pnotify_type=="error"?a.pnotify_error_icon:
a.pnotify_notice_icon})).appendTo(b.container);b.title_container=c("<span />",{"class":"ui-pnotify-title",html:a.pnotify_title}).appendTo(b.container);typeof a.pnotify_title!="string"&&b.title_container.hide();if(a.pnotify_insert_brs&&typeof a.pnotify_text=="string")a.pnotify_text=a.pnotify_text.replace("\n","<br />");b.text_container=c("<span />",{"class":"ui-pnotify-text",html:a.pnotify_text}).appendTo(b.container);typeof a.pnotify_text!="string"&&b.text_container.hide();typeof a.pnotify_width==
"string"&&b.css("width",a.pnotify_width);typeof a.pnotify_min_height=="string"&&b.container.css("min-height",a.pnotify_min_height);b.pnotify_history=a.pnotify_history;var f=i.data("pnotify");if(typeof f!="object")f=[];f=c.merge(f,[b]);i.data("pnotify",f);a.pnotify_after_init&&a.pnotify_after_init(b);if(a.pnotify_history){var h=i.data("pnotify_history");if(typeof h=="undefined"){h=c("<div />",{"class":"ui-pnotify-history-container ui-state-default ui-corner-bottom",mouseleave:function(){h.animate({top:"-"+
n+"px"},{duration:100,queue:false})}}).append(c("<div />",{"class":"ui-pnotify-history-header",text:"Redisplay"})).append(c("<button />",{"class":"ui-pnotify-history-all ui-state-default ui-corner-all",text:"All",hover:function(){c(this).toggleClass("ui-state-hover")},click:function(){c.each(f,function(){this.pnotify_history&&this.pnotify_display&&this.pnotify_display()});return false}})).append(c("<button />",{"class":"ui-pnotify-history-last ui-state-default ui-corner-all",text:"Last",hover:function(){c(this).toggleClass("ui-state-hover")},
click:function(){for(var d=1;!f[f.length-d]||!f[f.length-d].pnotify_history;){if(f.length-d===0)return false;d++}f[f.length-d].pnotify_display&&f[f.length-d].pnotify_display();return false}})).appendTo(i);n=c("<span />",{"class":"ui-pnotify-history-pulldown ui-icon ui-icon-grip-dotted-horizontal",mouseenter:function(){h.animate({top:"0"},{duration:100,queue:false})}}).appendTo(h).offset().top+2;h.css({top:"-"+n+"px"});i.data("pnotify_history",h)}}b.pnotify_display();return b}});c.pnotify.defaults=
{pnotify_addclass:"",pnotify_history:true,pnotify_width:"300px",pnotify_min_height:"16px",pnotify_type:"notice",pnotify_notice_icon:"ui-icon ui-icon-info",pnotify_error_icon:"ui-icon ui-icon-alert",pnotify_animation:"fade",pnotify_animate_speed:"slow",pnotify_opacity:1,pnotify_closer:true,pnotify_hide:true,pnotify_delay:8E3,pnotify_remove:true,pnotify_insert_brs:true}})(jQuery);
